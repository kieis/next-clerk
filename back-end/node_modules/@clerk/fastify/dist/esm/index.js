var b=Object.create;var k=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var H=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var I=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var U=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of T(t))!N.call(e,n)&&n!==i&&k(e,n,{get:()=>t[n],enumerable:!(r=L(t,n))||r.enumerable});return e};var Y=(e,t,i)=>(i=e!=null?b(H(e)):{},U(t||!e||!e.__esModule?k(i,"default",{value:e,enumerable:!0}):i,e));var C=I(h=>{"use strict";h.parse=M;h.serialize=W;var D=Object.prototype.toString,u=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function M(e,t){if(typeof e!="string")throw new TypeError("argument str must be a string");for(var i={},r=t||{},n=r.decode||j,s=0;s<e.length;){var o=e.indexOf("=",s);if(o===-1)break;var a=e.indexOf(";",s);if(a===-1)a=e.length;else if(a<o){s=e.lastIndexOf(";",o-1)+1;continue}var p=e.slice(s,o).trim();if(i[p]===void 0){var f=e.slice(o+1,a).trim();f.charCodeAt(0)===34&&(f=f.slice(1,-1)),i[p]=z(f,n)}s=a+1}return i}function W(e,t,i){var r=i||{},n=r.encode||B;if(typeof n!="function")throw new TypeError("option encode is invalid");if(!u.test(e))throw new TypeError("argument name is invalid");var s=n(t);if(s&&!u.test(s))throw new TypeError("argument val is invalid");var o=e+"="+s;if(r.maxAge!=null){var a=r.maxAge-0;if(isNaN(a)||!isFinite(a))throw new TypeError("option maxAge is invalid");o+="; Max-Age="+Math.floor(a)}if(r.domain){if(!u.test(r.domain))throw new TypeError("option domain is invalid");o+="; Domain="+r.domain}if(r.path){if(!u.test(r.path))throw new TypeError("option path is invalid");o+="; Path="+r.path}if(r.expires){var p=r.expires;if(!V(p)||isNaN(p.valueOf()))throw new TypeError("option expires is invalid");o+="; Expires="+p.toUTCString()}if(r.httpOnly&&(o+="; HttpOnly"),r.secure&&(o+="; Secure"),r.priority){var f=typeof r.priority=="string"?r.priority.toLowerCase():r.priority;switch(f){case"low":o+="; Priority=Low";break;case"medium":o+="; Priority=Medium";break;case"high":o+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(r.sameSite){var c=typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite;switch(c){case!0:o+="; SameSite=Strict";break;case"lax":o+="; SameSite=Lax";break;case"strict":o+="; SameSite=Strict";break;case"none":o+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return o}function j(e){return e.indexOf("%")!==-1?decodeURIComponent(e):e}function B(e){return encodeURIComponent(e)}function V(e){return D.call(e)==="[object Date]"||e instanceof Date}function z(e,t){try{return t(e)}catch{return e}}});import G from"fastify-plugin";var w=["onRequest","preHandler"];var x=Y(C());import{Clerk as q}from"@clerk/backend";import{constants as J}from"@clerk/backend";var R=process.env.CLERK_API_URL||"https://api.clerk.dev",A=process.env.CLERK_API_VERSION||"v1",v=process.env.CLERK_API_KEY||"",d=process.env.CLERK_SECRET_KEY||"",y=process.env.CLERK_FRONTEND_API||"",O=process.env.CLERK_PUBLISHABLE_KEY||"",S=process.env.CLERK_JWT_KEY||"",{Cookies:E,Headers:l}=J;var _=q,m=_({secretKey:d,apiUrl:R,apiVersion:A,jwtKey:S});var g=e=>(Array.isArray(e)?e[0]:e)||void 0;var K=e=>async(t,i)=>{let r=(0,x.parse)(t.raw.headers.cookie||""),n=e.secretKey||d,s=e.publishableKey||O,o=r[E.Session],a=t.headers.authorization?.replace("Bearer ",""),p=g(t.headers["x-forwarded-port"]),f=g(t.headers["x-forwarded-host"]),c=await m.authenticateRequest({...e,secretKey:n,publishableKey:s,apiKey:v,frontendApi:y,cookieToken:o,headerToken:a,clientUat:r[E.ClientUat],origin:t.headers.origin||void 0,host:t.headers.host,forwardedPort:p,forwardedHost:f,referrer:t.headers.referer||void 0,userAgent:t.headers["user-agent"]||void 0});if(c.isUnknown)return i.code(401).header(l.AuthReason,c.reason).header(l.AuthMessage,c.message).send();if(c.isInterstitial){let P=m.localInterstitial({publishableKey:s,frontendApi:y});return i.code(401).header(l.AuthReason,c.reason).header(l.AuthMessage,c.message).type("text/html").send(P)}t.auth=c.toAuth()};var Q=(e,t,i)=>{e.decorateRequest("auth",null);let r=t.hookName||"preHandler";if(!w.includes(r))throw new Error(`Unsupported hookName: ${r}`);e.addHook(r,K(t)),i()},X=G(Q,{name:"@clerk/fastify",fastify:"4.x"});var Z=e=>`\u{1F512} Clerk: ${e.trim()}

For more info, check out the docs: https://clerk.com/docs,
or come say hi in our discord server: https://clerk.com/discord
`,F=Z(`The "clerkPlugin" should be registered before using the "getAuth".
Example:

import { clerkPlugin } from '@clerk/fastify';

const server: FastifyInstance = Fastify({ logger: true });
server.register(clerkPlugin);
`);var ee=e=>{let t=e;if(!t.auth)throw new Error(F);return t.auth};export{m as clerkClient,X as clerkPlugin,_ as createClerkClient,ee as getAuth};
/*! Bundled license information:

cookie/index.js:
  (*!
   * cookie
   * Copyright(c) 2012-2014 Roman Shtylman
   * Copyright(c) 2015 Douglas Christopher Wilson
   * MIT Licensed
   *)
*/
//# sourceMappingURL=index.js.map