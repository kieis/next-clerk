"use strict";var Y=Object.create;var d=Object.defineProperty;var D=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var W=Object.getPrototypeOf,j=Object.prototype.hasOwnProperty;var B=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),V=(e,t)=>{for(var i in t)d(e,i,{get:t[i],enumerable:!0})},C=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of M(t))!j.call(e,n)&&n!==i&&d(e,n,{get:()=>t[n],enumerable:!(r=D(t,n))||r.enumerable});return e};var R=(e,t,i)=>(i=e!=null?Y(W(e)):{},C(t||!e||!e.__esModule?d(i,"default",{value:e,enumerable:!0}):i,e)),z=e=>C(d({},"__esModule",{value:!0}),e);var v=B(y=>{"use strict";y.parse=$;y.serialize=q;var J=Object.prototype.toString,m=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function $(e,t){if(typeof e!="string")throw new TypeError("argument str must be a string");for(var i={},r=t||{},n=r.decode||G,s=0;s<e.length;){var o=e.indexOf("=",s);if(o===-1)break;var a=e.indexOf(";",s);if(a===-1)a=e.length;else if(a<o){s=e.lastIndexOf(";",o-1)+1;continue}var p=e.slice(s,o).trim();if(i[p]===void 0){var f=e.slice(o+1,a).trim();f.charCodeAt(0)===34&&(f=f.slice(1,-1)),i[p]=Z(f,n)}s=a+1}return i}function q(e,t,i){var r=i||{},n=r.encode||Q;if(typeof n!="function")throw new TypeError("option encode is invalid");if(!m.test(e))throw new TypeError("argument name is invalid");var s=n(t);if(s&&!m.test(s))throw new TypeError("argument val is invalid");var o=e+"="+s;if(r.maxAge!=null){var a=r.maxAge-0;if(isNaN(a)||!isFinite(a))throw new TypeError("option maxAge is invalid");o+="; Max-Age="+Math.floor(a)}if(r.domain){if(!m.test(r.domain))throw new TypeError("option domain is invalid");o+="; Domain="+r.domain}if(r.path){if(!m.test(r.path))throw new TypeError("option path is invalid");o+="; Path="+r.path}if(r.expires){var p=r.expires;if(!X(p)||isNaN(p.valueOf()))throw new TypeError("option expires is invalid");o+="; Expires="+p.toUTCString()}if(r.httpOnly&&(o+="; HttpOnly"),r.secure&&(o+="; Secure"),r.priority){var f=typeof r.priority=="string"?r.priority.toLowerCase():r.priority;switch(f){case"low":o+="; Priority=Low";break;case"medium":o+="; Priority=Medium";break;case"high":o+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(r.sameSite){var c=typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite;switch(c){case!0:o+="; SameSite=Strict";break;case"lax":o+="; SameSite=Lax";break;case"strict":o+="; SameSite=Strict";break;case"none":o+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return o}function G(e){return e.indexOf("%")!==-1?decodeURIComponent(e):e}function Q(e){return encodeURIComponent(e)}function X(e){return J.call(e)==="[object Date]"||e instanceof Date}function Z(e,t){try{return t(e)}catch{return e}}});var oe={};V(oe,{clerkClient:()=>u,clerkPlugin:()=>H,createClerkClient:()=>k,getAuth:()=>I});module.exports=z(oe);var T=R(require("fastify-plugin"));var A=["onRequest","preHandler"];var b=R(v());var P=require("@clerk/backend");var O=require("@clerk/backend"),S=process.env.CLERK_API_URL||"https://api.clerk.dev",_=process.env.CLERK_API_VERSION||"v1",x=process.env.CLERK_API_KEY||"",h=process.env.CLERK_SECRET_KEY||"",E=process.env.CLERK_FRONTEND_API||"",K=process.env.CLERK_PUBLISHABLE_KEY||"",F=process.env.CLERK_JWT_KEY||"",{Cookies:g,Headers:l}=O.constants;var k=P.Clerk,u=k({secretKey:h,apiUrl:S,apiVersion:_,jwtKey:F});var w=e=>(Array.isArray(e)?e[0]:e)||void 0;var L=e=>async(t,i)=>{let r=(0,b.parse)(t.raw.headers.cookie||""),n=e.secretKey||h,s=e.publishableKey||K,o=r[g.Session],a=t.headers.authorization?.replace("Bearer ",""),p=w(t.headers["x-forwarded-port"]),f=w(t.headers["x-forwarded-host"]),c=await u.authenticateRequest({...e,secretKey:n,publishableKey:s,apiKey:x,frontendApi:E,cookieToken:o,headerToken:a,clientUat:r[g.ClientUat],origin:t.headers.origin||void 0,host:t.headers.host,forwardedPort:p,forwardedHost:f,referrer:t.headers.referer||void 0,userAgent:t.headers["user-agent"]||void 0});if(c.isUnknown)return i.code(401).header(l.AuthReason,c.reason).header(l.AuthMessage,c.message).send();if(c.isInterstitial){let U=u.localInterstitial({publishableKey:s,frontendApi:E});return i.code(401).header(l.AuthReason,c.reason).header(l.AuthMessage,c.message).type("text/html").send(U)}t.auth=c.toAuth()};var te=(e,t,i)=>{e.decorateRequest("auth",null);let r=t.hookName||"preHandler";if(!A.includes(r))throw new Error(`Unsupported hookName: ${r}`);e.addHook(r,L(t)),i()},H=(0,T.default)(te,{name:"@clerk/fastify",fastify:"4.x"});var re=e=>`\u{1F512} Clerk: ${e.trim()}

For more info, check out the docs: https://clerk.com/docs,
or come say hi in our discord server: https://clerk.com/discord
`,N=re(`The "clerkPlugin" should be registered before using the "getAuth".
Example:

import { clerkPlugin } from '@clerk/fastify';

const server: FastifyInstance = Fastify({ logger: true });
server.register(clerkPlugin);
`);var I=e=>{let t=e;if(!t.auth)throw new Error(N);return t.auth};0&&(module.exports={clerkClient,clerkPlugin,createClerkClient,getAuth});
/*! Bundled license information:

cookie/index.js:
  (*!
   * cookie
   * Copyright(c) 2012-2014 Roman Shtylman
   * Copyright(c) 2015 Douglas Christopher Wilson
   * MIT Licensed
   *)
*/
//# sourceMappingURL=index.js.map